# 数据库作业10
## 1
试述事务的概念及事务的 4 个特性。恢复技术能保证事务的哪些特性？

**事务的概念**：事务是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一 个不可分割的工作单位。

**事务的四个特性**：

* 原子性：事务是数据库的逻辑工作单位，事务中包括的诸操作要么都做，要么都不做。
* 一致性：事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。
* 隔离性：一个事务的执行不能被其他事务干扰。
* 持续性：一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。

恢复技术可以保证事务的原子性、持续性。

## 4
考虑下图所示的日志记录：

| 序号 | 日志 |
| --- | --- |
| 1 | T1：开始 |
| 2 | T1：写A，A=10 |
| 3 | T2：开始 |
| 4 | T2：写B，B=9 |
| 5 | T1：写C，C=11 |
| 6 | T1：提交 |
| 7 | T2：写C，C=13 |
| 8 | T3：开始 |
| 9 | T3：写A，A=8 |
| 10 | T2：回滚 |
| 11 | T3：写B，B=7 |
| 12 | T4：开始 |
| 13 | T3：提交 |
| 14 | T4：写C，C=12 |

(1) 如果系统故障发生在 14 之后，说明哪些事务需要重做，哪些事务需要回滚。
重做：T1，T3
回滚：T2，T4

(2) 如果系统故障发生在 10 之后，说明哪些事务需要重做，哪些事务需要回滚。
重做：T1
回滚：T2，T3

(3) 如果系统故障发生在 9 之后，说明哪些事务需要重做，哪些事务需要回滚。 
重做：T1
回滚：T2，T3

(4) 如果系统故障发生在 7 之后，说明哪些事务需要重做，哪些事务需要回滚。
重做：T1
回滚：T2

## 6
针对不同的故障，试给出恢复的策略和方法。 （即如何进行事务故障的恢复，如何进行系统故障的恢复，以及如何进行介质故障的恢复。）

**事务故障的恢复**：

1. 反向扫描日志文件（即从最后向前扫描日志文件），查找该事务的更新操作。
2. 对该事务的更新操作执行逆操作。
3. 继续反向扫描日志文件，查找该事务的其他更新操作，并做同样处理。
4. 如此处理下去，直至读到此事务的开始标记，事务故障恢复就完成了 。

**系统故障的恢复**：

1. 正向扫描日志文件（即从头扫描日志文件），找出在故障发生前已经提交的事务，将其事务标识记入重做队列。同时找出故障发生时尚未完成的事务，将其事务标识记入撤销队列。
2. 对撤销队列中的各个事务进行撤销处理。进行撤销处理的方法是，反向扫描日志文件，对每个撤销事务的更新操作执行逆操作， 即将日志记录中“更新前的值”写入数据库。
3. 对重做队列中的各个事务进行重做处理。进行重做处理的方法是：正向扫描日志文件，对每个重做事务重新执行日志文件登记的操作，即将日志记录中“更新后的值”写入数据库。

**介质故障的恢复**：

1. 装入最新的数据库后备副本（离故障发生时刻最近的转储副本），使数据库恢复到最近一次转储时的一致性状态。对千动态转储的数据库副本，还需同时装入转储开始时刻的日志文件副本，利用恢复系统故障的方法, 才能将数据库恢复到一致性状态。
2. 装入相应的日志文件副本（转储结束时刻的日志文件副本），重做已完成的事务。 即首先扫描日志文件，找出故障发生时已提交的事务的标识，将其记入重做队列；然后正向扫描日志文件，对重做队列中的所有事务进行重做处理。即将日志记录中“更新后的值” 写入数据库。